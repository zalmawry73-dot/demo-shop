{% extends "base.html" %}

{% block title %}{{ 'โ๏ธ ุชุนุฏูู ููุชุฌ' if mode == 'edit' else 'โ ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ' }} | ููุตุฉ ุงูุชุงุฌุฑ{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', path='css/product_catalog.css') }}">
<!-- Quill.js for rich text -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="content-header">
    <div style="display:flex; align-items:center; gap:15px;">
        <button class="action-btn secondary" onclick="window.location.href='/catalog/products'"
            style="border-radius:50%; width:40px; height:40px; padding:0; display:flex; align-items:center; justify-content:center;">
            <i class="fa-solid fa-arrow-right"></i>
        </button>
        <h1>{{ 'โ๏ธ ุชุนุฏูู ููุชุฌ' if mode == 'edit' else 'โ ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ' }}</h1>
    </div>
    <div class="header-actions" style="display:flex; gap:10px">
        <button class="action-btn" id="saveBtn">๐พ ุญูุธ</button>
    </div>
</div>

<!-- Tabs -->
<nav class="tabs">
    <button class="tab active" data-target="tab-general">
        <i class="fa-solid fa-info-circle"></i> ุงููุนูููุงุช ุงูุนุงูุฉ
    </button>
    <button class="tab" data-target="tab-media">
        <i class="fa-solid fa-images"></i> ุงููุณุงุฆุท
    </button>
    <button class="tab" data-target="tab-pricing">
        <i class="fa-solid fa-tag"></i> ุงูุชุณุนูุฑ ูุงููุฎุฒูู
    </button>
    <button class="tab" data-target="tab-variants">
        <i class="fa-solid fa-layer-group"></i> ุงูุฃููุงุน (Variants)
    </button>
    <button class="tab" data-target="tab-custom">
        <i class="fa-solid fa-list-ul"></i> ุจูุงูุงุช ุฅุถุงููุฉ
    </button>
    <button class="tab" data-target="tab-seo">
        <i class="fa-solid fa-search"></i> ุชุญุณูู ูุญุฑูุงุช ุงูุจุญุซ
    </button>
</nav>

<!-- Tab Panels -->
<section class="tab-panels">

    <!-- 1๏ธโฃ General Info -->
    <div class="panel active" id="tab-general">
        <div class="form-group">
            <label for="productName">ุงุณู ุงูููุชุฌ *</label>
            <input type="text" id="productName" class="input-style" placeholder="ูุซุงู: ูููุต ูุทูู ูุงุฎุฑ" required>
        </div>

        <div class="form-group">
            <label for="productDesc">ุงููุตู (HTML)</label>
            <div id="productDesc" class="rich-editor"></div>
        </div>

        <div class="form-row">
            <div class="form-group" style="flex:1">
                <label for="productCategory">ุงูุชุตููู</label>
                <select id="productCategory" class="input-style">
                    <option value="">ุงุฎุชุฑ ุงูุชุตููู...</option>
                </select>
            </div>

            <div class="form-group" style="flex:1">
                <label for="productType">ููุน ุงูููุชุฌ</label>
                <select id="productType" class="input-style">
                    <option value="Physical">ูุงุฏู (Physical)</option>
                    <option value="Digital">ุฑููู (Digital)</option>
                    <option value="Service">ุฎุฏูุฉ (Service)</option>
                    <option value="Food">ุทุนุงู (Food)</option>
                </select>
            </div>

            <div class="form-group" style="flex:1">
                <label for="productStatus">ุงูุญุงูุฉ</label>
                <select id="productStatus" class="input-style">
                    <option value="Draft">ูุณูุฏุฉ</option>
                    <option value="Active">ูุดุท</option>
                    <option value="Archived">ูุคุฑุดู</option>
                </select>
            </div>
        </div>

        <div class="form-group inline">
            <label><input type="checkbox" id="taxable"> ุฎุงุถุน ููุถุฑูุจุฉ (15%)</label>
        </div>
    </div>

    <!-- 2๏ธโฃ Media -->
    <div class="panel" id="tab-media">
        <div class="media-uploader" id="mediaUploader">
            <i class="fa-solid fa-cloud-upload-alt" style="font-size:3rem; color:#9ca3af; margin-bottom:10px;"></i>
            <p style="margin:0; font-size:1.1rem; color:#6b7280;">ุงุณุญุจ ุงูุตูุฑ ููุง ุฃู ุงุถุบุท ููุชุญุฏูุฏ</p>
            <p style="margin-top:5px; font-size:0.9rem; color:#9ca3af;">ูุฏุนู: JPG, PNG, WebP (ุญุชู 5 ููุบุงุจุงูุช)
            </p>
            <input type="file" multiple accept="image/*" hidden id="mediaInput">
        </div>
        <div class="media-preview" id="mediaPreview">
            <!-- Images will be added here -->
        </div>
    </div>

    <!-- 3๏ธโฃ Pricing & Inventory -->
    <div class="panel" id="tab-pricing">
        <div class="form-row">
            <div class="form-group">
                <label for="basePrice">ุงูุณุนุฑ ุงูุฃุณุงุณู *</label>
                <input type="number" id="basePrice" class="input-style" step="0.01" min="0" placeholder="0.00" required>
            </div>

            <div class="form-group">
                <label for="costPrice">ุณุนุฑ ุงูุชูููุฉ (ุงุฎุชูุงุฑู)</label>
                <input type="number" id="costPrice" class="input-style" step="0.01" min="0" placeholder="0.00">
                <small style="color:#6b7280;">ูุญุณุงุจ ูุงูุด ุงูุฑุจุญ</small>
            </div>

            <div class="form-group">
                <label for="comparePrice">ุงูุณุนุฑ ูุจู ุงูุฎุตู</label>
                <input type="number" id="comparePrice" class="input-style" step="0.01" min="0" placeholder="0.00">
                <small style="color:#6b7280;">ูุฅุธูุงุฑ ูุณุจุฉ ุงูุชูููุฑ</small>
            </div>
        </div>

        <div class="form-group inline">
            <label><input type="checkbox" id="trackQty"> ุชุชุจุน ุงููุฎุฒูู</label>
        </div>

        <div class="form-group" id="qtyGroup" style="display:none;">
            <label for="stockQty">ุงููููุฉ ุงููุชููุฑุฉ</label>
            <input type="number" id="stockQty" class="input-style" min="0" value="0">
        </div>
    </div>

    <!-- 4๏ธโฃ Variants -->
    <div class="panel" id="tab-variants">
        <section class="options-builder">
            <h3>ุฎุตุงุฆุต ุงูููุชุฌ (Options)</h3>
            <p style="color:#6b7280; margin-bottom:15px;">ุฃุถู ุฎุตุงุฆุต ูุซู ุงููููุ ุงูููุงุณ ูุฅูุดุงุก ูุชุบูุฑุงุช ุชููุงุฆูุงู
            </p>
            <div id="optionsContainer"></div>
            <button type="button" class="action-btn secondary" id="addOptionBtn">
                <i class="fa-solid fa-plus"></i> ุฅุถุงูุฉ ุฎุงุตูุฉ
            </button>
        </section>

        <section class="variants-table" style="margin-top:30px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3 style="margin:0;">ุงูุฃููุงุน ุงููููุฏุฉ (<span id="variantCount">0</span>)</h3>
                <button type="button" class="btn btn-secondary" onclick="ProductEditor.regenerateVariants()">
                    <i class="fa-solid fa-sync"></i> ุฅุนุงุฏุฉ ุงูุชูููุฏ
                </button>
            </div>
            <div style="overflow-x:auto;">
                <table id="variantsGrid">
                    <thead>
                        <tr id="variantHeaderRow">
                            <th>SKU</th>
                            <th>ุงููููุฉ</th>
                            <th>ุงูุณุนุฑ</th>
                        </tr>
                    </thead>
                    <tbody id="variantsGridBody">
                        <tr>
                            <td colspan="3" style="text-align:center; padding:20px; color:#9ca3af;">
                                ุฃุถู ุฎุตุงุฆุต ุงูููุชุฌ ูุชูููุฏ ุงูุฃููุงุน ุชููุงุฆูุงู
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <!-- 5๏ธโฃ Custom Fields -->
    <div class="panel" id="tab-custom">
        <div id="customFieldsContainer"></div>
        <div id="customFieldsLoader"></div>
    </div>

    <!-- 6๏ธโฃ SEO -->
    <div class="panel" id="tab-seo">
        <div class="form-group">
            <label for="pageTitle">ุนููุงู ุงูุตูุญุฉ (Page Title)</label>
            <input type="text" id="pageTitle" class="input-style" maxlength="60"
                placeholder="ุณูุชู ุงุณุชุฎุฏุงู ุงุณู ุงูููุชุฌ ุฅุฐุง ุชุฑู ูุงุฑุบุงู">
            <small style="color:#6b7280;"><span id="titleCharCount">0</span> / 60 ุญุฑู</small>
        </div>

        <div class="form-group">
            <label for="metaDesc">ูุตู ุงูููุชุง (Meta Description)</label>
            <textarea id="metaDesc" class="input-style" rows="3" maxlength="160"
                placeholder="ูุตู ูุฎุชุตุฑ ููููุชุฌ ูุธูุฑ ูู ูุชุงุฆุฌ ุงูุจุญุซ"></textarea>
            <small style="color:#6b7280;"><span id="descCharCount">0</span> / 160 ุญุฑู</small>
        </div>

        <div class="form-group">
            <label for="slug">ุงูุฑุงุจุท (Slug) *</label>
            <input type="text" id="slug" class="input-style" placeholder="product-name-in-english" required>
            <small style="color:#6b7280;">ุณูุชู ุชูููุฏู ุชููุงุฆูุงู ูู ุงุณู ุงูููุชุฌ</small>
        </div>

        <div class="seo-preview" id="seoPreview">
            <p style="margin:0 0 10px; font-size:0.9rem; color:#6b7280; font-weight:600;">๐๏ธ ูุนุงููุฉ ูู ุฌูุฌู</p>
            <p class="preview-title">ุนููุงู ุงูููุชุฌ</p>
            <p class="preview-link">https://yourstore.com/<span id="previewSlug">slug</span></p>
            <p class="preview-desc">ูุตู ุงูููุชุง ุณูุธูุฑ ููุง...</p>
        </div>
    </div>

</section>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
<script src="{{ url_for('static', path='js/product_editor.js') }}?v=6"></script>
<script>
    // Initialize editor
    document.addEventListener('DOMContentLoaded', () => {
        const mode = "{{ mode }}";
        const productId = "{{ product_id if mode == 'edit' else '' }}";
        // Ensure ProductEditor exists before calling init
        if (typeof ProductEditor !== 'undefined') {
            ProductEditor.init(mode, productId);
        } else {
            console.error('ProductEditor is not defined!');
        }
    });
</script>
{% endblock %}