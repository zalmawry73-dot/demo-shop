{% extends "base.html" %}

{% block title %}ساعات العمل | منصة التاجر{% endblock %}

{% block page_title %}ساعات العمل{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div class="d-flex align-items-center gap-3">
        <a href="/settings" class="btn btn-light rounded-circle p-2 d-flex align-items-center justify-content-center"
            style="width: 40px; height: 40px;">
            <i class="fa-solid fa-arrow-right"></i>
        </a>
        <h4 class="fw-bold mb-0">ساعات العمل</h4>
    </div>
    <div class="d-flex gap-2">
        <button class="btn btn-outline-primary" id="toggleFeatureBtn" onclick="toggleFeature()">تفعيل الميزة</button>
        <button class="btn btn-primary px-4" id="saveBtn" onclick="saveSettings()">حفظ</button>
    </div>
</div>

<div class="card border-0 shadow-sm">
    <div class="card-body p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h5 class="fw-bold mb-1">حالة المتجر وساعات العمل</h5>
                <p class="text-muted mb-0">يمكنك التحكم في إغلاق متجرك أو إيقاف استقبال الطلبات في أوقات محددة.</p>
            </div>
        </div>

        <div id="featureContent" class="opacity-50" style="pointer-events: none;">
            <!-- Disabled by default until enabled -->

            <!-- Mechanism Selection -->
            <div class="mb-4">
                <label class="form-label fw-bold d-block mb-3">اختر آلية الإغلاق</label>
                <div class="d-flex gap-4">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="maintenanceType" id="typeFullClose"
                            value="fully_closed" checked onchange="updateUI()">
                        <label class="form-check-label" for="typeFullClose">
                            إغلاق المتجر بالكامل
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="maintenanceType" id="typeStopOrders"
                            value="stop_orders" onchange="updateUI()">
                        <label class="form-check-label" for="typeStopOrders">
                            إيقاف استقبال الطلبات
                        </label>
                    </div>
                </div>
            </div>

            <!-- Warning Banner & Example -->
            <div class="alert alert-warning mb-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <i class="fa-solid fa-triangle-exclamation me-2 fs-5"></i>
                        <span id="warningText">سيتم إغلاق متجرك بالكامل خلال الفترات المحددة. لن يتمكن العملاء من تصفح
                            المتجر.</span>
                    </div>
                    <button class="btn btn-sm btn-outline-dark bg-white" onclick="showExample()">عرض مثال</button>
                </div>
            </div>

            <!-- Period Selection -->
            <div class="row g-4 mb-4">
                <div class="col-md-12">
                    <label class="form-label fw-bold">اختر نوع الفترة</label>
                    <select class="form-select" id="periodType" onchange="updateUI()">
                        <option value="unlimited">دون تحديد فترة زمنية</option>
                        <option value="minutes">فترة زمنية بالدقائق</option>
                        <option value="hours">فترة زمنية بالساعات</option>
                        <option value="scheduled">فترة مخصصة (تاريخ ووقت)</option>
                        <option value="daily_schedule">تحديد فترة مخصصة بالأيام</option>
                    </select>
                </div>

                <!-- Dynamic Period Fields -->

                <!-- Unlimited Info -->
                <div class="col-12 period-group" id="group_unlimited">
                    <div class="text-muted small">
                        <i class="fa-solid fa-circle-info me-1"></i>
                        إذا لم تُحدد وقتًا معينًا، فسيظل المتجر مغلقًا حتى تقوم بفتحه يدويًا.
                    </div>
                </div>

                <!-- Mins -->
                <div class="col-md-6 period-group d-none" id="group_minutes">
                    <label class="form-label">مدة الإغلاق (بالدقائق)</label>
                    <input type="number" class="form-control" id="maintenanceMinutes" placeholder="30">
                </div>

                <!-- Hours -->
                <div class="col-md-6 period-group d-none" id="group_hours">
                    <label class="form-label">مدة الإغلاق (بالساعات)</label>
                    <input type="number" class="form-control" id="maintenanceHours" placeholder="2">
                </div>

                <!-- Scheduled -->
                <div class="col-md-6 period-group d-none" id="group_scheduled_start">
                    <label class="form-label">من تاريخ</label>
                    <input type="datetime-local" class="form-control" id="maintenanceStartAt">
                </div>
                <div class="col-md-6 period-group d-none" id="group_scheduled_end">
                    <label class="form-label">حتى تاريخ</label>
                    <input type="datetime-local" class="form-control" id="maintenanceEndAt">
                </div>

                <!-- Daily Schedule -->
                <div class="col-12 period-group d-none" id="group_daily_schedule">
                    <div id="dailyScheduleContainer" class="d-flex flex-column gap-3">
                        <!-- Days will be injected here via JS -->
                    </div>
                </div>

                <!-- Countdown Toggle (For Mins/Hours) -->
                <div class="col-12 period-group d-none" id="group_countdown">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="showCountdown">
                        <label class="form-check-label" for="showCountdown">عرض عدّاد تنازلي حتى إعادة فتح
                            المتجر</label>
                    </div>
                </div>
            </div>

            <hr class="text-muted opacity-25">

            <!-- Content Config -->
            <div class="row g-4">
                <div class="col-12">
                    <h6 class="fw-bold">محتوى رسالة الإغلاق</h6>
                </div>

                <div class="col-md-6">
                    <label class="form-label">العنوان (العربية)</label>
                    <input type="text" class="form-control" id="titleAr" placeholder="المتجر مغلق مؤقتاً">
                </div>
                <div class="col-md-6">
                    <label class="form-label">العنوان (الإنجليزية)</label>
                    <input type="text" class="form-control" id="titleEn" placeholder="Store Temporarily Closed"
                        dir="ltr">
                </div>

                <div class="col-md-6">
                    <label class="form-label">نص الرسالة (العربية)</label>
                    <textarea class="form-control" id="messageAr" rows="3"
                        placeholder="نعمل حالياً على تحسين تجربتكم..."></textarea>
                </div>
                <div class="col-md-6">
                    <label class="form-label">نص الرسالة (الإنجليزية)</label>
                    <textarea class="form-control" id="messageEn" rows="3"
                        placeholder="We are currently working to improve your experience..." dir="ltr"></textarea>
                </div>
            </div>

        </div> <!-- End Feature Content -->
    </div>
</div>

<!-- Example Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content overflow-hidden border-0">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title fw-bold">مثال على طريقة ظهورها لعملائك</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center p-5">
                <!-- Mockup Container -->
                <div class="card border-0 shadow-sm mx-auto" style="max-width: 600px; background: #f8f9fa;">
                    <div class="card-body p-5">
                        <div class="mb-4">
                            <i class="fa-solid fa-store fa-3x text-secondary opacity-50"></i>
                        </div>
                        <h3 class="fw-bold mb-3" id="previewTitle">المتجر تحت التطوير</h3>
                        <p class="text-muted mb-4" id="previewMessage">عميلنا العزيز، نعتذر عن إغلاق المتجر مؤقتاً
                            وسنعاود العمل قريباً. شكراً لتفهمك.</p>

                        <div id="previewCountdown" class="d-none bg-white border rounded p-3 d-inline-block shadow-sm">
                            <span class="fw-bold text-primary fs-4" dir="ltr">00 : 45 : 30</span>
                            <div class="small text-muted mt-1">وقت متبقي للفتح</div>
                        </div>

                        <div id="previewStopOrders" class="d-none mt-4 text-warning">
                            <div class="alert alert-warning border-0 bg-warning-subtle text-warning-emphasis">
                                <i class="fa-solid fa-ban me-1"></i>
                                الشراء غير متاح حالياً
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0 justify-content-center pb-4">
                <button type="button" class="btn btn-secondary px-5 rounded-pill" data-bs-dismiss="modal">إغلاق</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="/static/js/settings_maintenance.js"></script>
{% endblock %}